window.addEventListener("DOMContentLoaded",()=>{let body=document.querySelector("body"),qrcodeBox=document.querySelector(".qrcode-box"),copyUrl=document.querySelector("#copyUrl"),saveImg=document.querySelector("#saveImg"),qrcode=null,currPageURl=null;function sendNotifications(options={}){let notID=`notif${(new Date).getTime()}`;chrome.notifications.create(notID,options,function(){setTimeout(()=>{chrome.notifications.clear(notID,function(wasCleared){console.log("Notification "+notID+" cleared: "+wasCleared)})},3e3)})}document.querySelector(".setting-hint a").href=`chrome-extension://${chrome.runtime.id}/options.html`,chrome.storage.sync.get(["config"],result=>{let oldData=result.config?JSON.parse(result.config):{};body.style.width=`${oldData.size}px`,chrome.tabs.query({active:!0,currentWindow:!0},tab=>{currPageURl=tab[0].url,qrcode=null,qrcode=new QRCode(qrcodeBox,{text:currPageURl,width:(oldData.size||240)*window.devicePixelRatio,height:(oldData.size||240)*window.devicePixelRatio,colorDark:oldData.foreColor||"#000000",colorLight:oldData.backColor||"#ffffff",border:{200:30,240:30,260:35,280:35,300:40,320:40}[oldData.size]||30,correctLevel:{L:QRCode.CorrectLevel.L,M:QRCode.CorrectLevel.M,Q:QRCode.CorrectLevel.Q,H:QRCode.CorrectLevel.H}[oldData.level]||QRCode.CorrectLevel.Q}),qrcodeBox.classList.remove("loading")})}),copyUrl.addEventListener("click",()=>{navigator.clipboard.writeText(currPageURl).then(function(){sendNotifications({type:"basic",title:"Copy success！",message:"Copied to clipboard",expandedMessage:"The link has been copied to the clipboard",iconUrl:"./images/qrcode.png"})})}),saveImg.addEventListener("click",()=>{var qrcodeImg=qrcodeBox.querySelector("img");chrome.downloads.download({url:qrcodeImg.src,filename:"qrcode.png"})})});